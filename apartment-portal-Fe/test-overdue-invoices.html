<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Overdue Invoices API</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Test Overdue Invoices API</h1>
    
    <div class="section">
        <h2>1. Lấy danh sách hóa đơn quá hạn</h2>
        <button onclick="getOverdueInvoices()">GET /api/admin/invoices/overdue</button>
        <div id="overdue-result"></div>
    </div>

    <div class="section">
        <h2>2. Cập nhật trạng thái quá hạn</h2>
        <button onclick="updateOverdueStatus()">POST /api/admin/invoices/update-overdue-status</button>
        <div id="update-result"></div>
    </div>

    <div class="section">
        <h2>3. Gửi email nhắc nhở</h2>
        <p>Nhập ID hóa đơn (cách nhau bằng dấu phẩy):</p>
        <input type="text" id="invoiceIds" placeholder="1,2,3" style="width: 200px; padding: 5px;">
        <button onclick="sendReminders()">POST /api/admin/invoices/send-overdue-reminders</button>
        <div id="reminder-result"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080';
        
        async function makeRequest(url, options = {}) {
            try {
                const response = await fetch(API_BASE + url, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                
                const data = await response.json();
                return { success: response.ok, data, status: response.status };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        async function getOverdueInvoices() {
            const result = await makeRequest('/api/admin/invoices/overdue');
            const div = document.getElementById('overdue-result');
            
            if (result.success) {
                div.innerHTML = `
                    <div class="success">
                        <h3>Thành công!</h3>
                        <p>Số lượng hóa đơn quá hạn: ${result.data.length}</p>
                        <pre>${JSON.stringify(result.data, null, 2)}</pre>
                    </div>
                `;
            } else {
                div.innerHTML = `
                    <div class="error">
                        <h3>Lỗi!</h3>
                        <p>Status: ${result.status}</p>
                        <pre>${JSON.stringify(result.data || result.error, null, 2)}</pre>
                    </div>
                `;
            }
        }

        async function updateOverdueStatus() {
            const result = await makeRequest('/api/admin/invoices/update-overdue-status', {
                method: 'POST'
            });
            const div = document.getElementById('update-result');
            
            if (result.success) {
                div.innerHTML = `
                    <div class="success">
                        <h3>Thành công!</h3>
                        <pre>${JSON.stringify(result.data, null, 2)}</pre>
                    </div>
                `;
            } else {
                div.innerHTML = `
                    <div class="error">
                        <h3>Lỗi!</h3>
                        <p>Status: ${result.status}</p>
                        <pre>${JSON.stringify(result.data || result.error, null, 2)}</pre>
                    </div>
                `;
            }
        }

        async function sendReminders() {
            const invoiceIdsInput = document.getElementById('invoiceIds');
            const invoiceIds = invoiceIdsInput.value.split(',').map(id => parseInt(id.trim())).filter(id => !isNaN(id));
            
            if (invoiceIds.length === 0) {
                alert('Vui lòng nhập ít nhất một ID hóa đơn');
                return;
            }

            const result = await makeRequest('/api/admin/invoices/send-overdue-reminders', {
                method: 'POST',
                body: JSON.stringify(invoiceIds)
            });
            const div = document.getElementById('reminder-result');
            
            if (result.success) {
                div.innerHTML = `
                    <div class="success">
                        <h3>Thành công!</h3>
                        <pre>${JSON.stringify(result.data, null, 2)}</pre>
                    </div>
                `;
            } else {
                div.innerHTML = `
                    <div class="error">
                        <h3>Lỗi!</h3>
                        <p>Status: ${result.status}</p>
                        <pre>${JSON.stringify(result.data || result.error, null, 2)}</pre>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
