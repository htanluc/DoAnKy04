<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API Vehicle Capacity</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; border-radius: 5px; }
        .result { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 3px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        button { padding: 10px 20px; margin: 5px; background: #2196f3; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #1976d2; }
        input, select { padding: 8px; margin: 5px; border: 1px solid #ccc; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>üöó Test API Vehicle Capacity Limit</h1>
    
    <div class="test-section">
        <h3>1. T·∫°o C·∫•u H√¨nh M·ªõi</h3>
        <input type="number" id="buildingId" placeholder="Building ID" value="1">
        <input type="number" id="maxCars" placeholder="Max Cars" value="50">
        <input type="number" id="maxMotorcycles" placeholder="Max Motorcycles" value="100">
        <button onclick="createConfig()">T·∫°o C·∫•u H√¨nh</button>
        <div id="createResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>2. L·∫•y T·∫•t C·∫£ C·∫•u H√¨nh</h3>
        <button onclick="getAllConfigs()">L·∫•y Danh S√°ch</button>
        <div id="getAllResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>3. L·∫•y C·∫•u H√¨nh Theo Building</h3>
        <input type="number" id="getBuildingId" placeholder="Building ID" value="1">
        <button onclick="getConfigByBuilding()">L·∫•y C·∫•u H√¨nh</button>
        <div id="getBuildingResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>4. Ki·ªÉm Tra Capacity</h3>
        <input type="number" id="checkBuildingId" placeholder="Building ID" value="1">
        <select id="vehicleType">
            <option value="CAR_4_SEATS">√î t√¥ 4 ch·ªó</option>
            <option value="CAR_7_SEATS">√î t√¥ 7 ch·ªó</option>
            <option value="MOTORCYCLE">Xe m√°y</option>
            <option value="TRUCK">Xe t·∫£i</option>
            <option value="VAN">Xe van</option>
            <option value="ELECTRIC_CAR">Xe ƒëi·ªán</option>
            <option value="ELECTRIC_MOTORCYCLE">Xe m√°y ƒëi·ªán</option>
            <option value="ELECTRIC_BICYCLE">Xe ƒë·∫°p ƒëi·ªán</option>
            <option value="BICYCLE">Xe ƒë·∫°p</option>
        </select>
        <button onclick="checkCapacity()">Ki·ªÉm Tra</button>
        <div id="checkResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>5. C·∫≠p Nh·∫≠t C·∫•u H√¨nh</h3>
        <input type="number" id="updateId" placeholder="Config ID" value="1">
        <input type="number" id="updateMaxCars" placeholder="Max Cars" value="60">
        <button onclick="updateConfig()">C·∫≠p Nh·∫≠t</button>
        <div id="updateResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>6. Toggle Active Status</h3>
        <input type="number" id="toggleId" placeholder="Config ID" value="1">
        <select id="toggleStatus">
            <option value="true">B·∫≠t</option>
            <option value="false">T·∫Øt</option>
        </select>
        <button onclick="toggleActive()">Thay ƒê·ªïi Tr·∫°ng Th√°i</button>
        <div id="toggleResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>7. X√≥a C·∫•u H√¨nh</h3>
        <input type="number" id="deleteId" placeholder="Config ID" value="1">
        <button onclick="deleteConfig()">X√≥a</button>
        <div id="deleteResult" class="result"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/api/vehicle-capacity-config';
        
        // L∆∞u JWT token (c·∫ßn ƒëƒÉng nh·∫≠p tr∆∞·ªõc)
        let jwtToken = localStorage.getItem('jwt_token') || prompt('Nh·∫≠p JWT Token:');
        if (jwtToken) {
            localStorage.setItem('jwt_token', jwtToken);
        }

        function showResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.className = `result ${isError ? 'error' : 'success'}`;
            element.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }

        async function apiCall(endpoint, options = {}) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    headers: {
                        'Authorization': `Bearer ${jwtToken}`,
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(`HTTP ${response.status}: ${errorData.error || response.statusText}`);
                }

                return await response.json();
            } catch (error) {
                throw error;
            }
        }

        async function createConfig() {
            try {
                const data = {
                    buildingId: parseInt(document.getElementById('buildingId').value),
                    maxCars: parseInt(document.getElementById('maxCars').value),
                    maxMotorcycles: parseInt(document.getElementById('maxMotorcycles').value),
                    maxTrucks: 20,
                    maxVans: 15,
                    maxElectricVehicles: 30,
                    maxBicycles: 80
                };

                const result = await apiCall('', {
                    method: 'POST',
                    body: JSON.stringify(data)
                });

                showResult('createResult', result);
            } catch (error) {
                showResult('createResult', { error: error.message }, true);
            }
        }

        async function getAllConfigs() {
            try {
                const result = await apiCall('');
                showResult('getAllResult', result);
            } catch (error) {
                showResult('getAllResult', { error: error.message }, true);
            }
        }

        async function getConfigByBuilding() {
            try {
                const buildingId = document.getElementById('getBuildingId').value;
                const result = await apiCall(`/building/${buildingId}`);
                showResult('getBuildingResult', result);
            } catch (error) {
                showResult('getBuildingResult', { error: error.message }, true);
            }
        }

        async function checkCapacity() {
            try {
                const buildingId = document.getElementById('checkBuildingId').value;
                const vehicleType = document.getElementById('vehicleType').value;
                const result = await apiCall(`/check-capacity?buildingId=${buildingId}&vehicleType=${vehicleType}`);
                showResult('checkResult', result);
            } catch (error) {
                showResult('checkResult', { error: error.message }, true);
            }
        }

        async function updateConfig() {
            try {
                const id = document.getElementById('updateId').value;
                const data = {
                    maxCars: parseInt(document.getElementById('updateMaxCars').value)
                };

                const result = await apiCall(`/${id}`, {
                    method: 'PUT',
                    body: JSON.stringify(data)
                });

                showResult('updateResult', result);
            } catch (error) {
                showResult('updateResult', { error: error.message }, true);
            }
        }

        async function toggleActive() {
            try {
                const id = document.getElementById('toggleId').value;
                const isActive = document.getElementById('toggleStatus').value === 'true';

                const result = await apiCall(`/${id}`, {
                    method: 'PUT',
                    body: JSON.stringify({ isActive })
                });

                showResult('toggleResult', result);
            } catch (error) {
                showResult('toggleResult', { error: error.message }, true);
            }
        }

        async function deleteConfig() {
            try {
                const id = document.getElementById('deleteId').value;
                await apiCall(`/${id}`, { method: 'DELETE' });
                showResult('deleteResult', { message: 'X√≥a th√†nh c√¥ng' });
            } catch (error) {
                showResult('deleteResult', { error: error.message }, true);
            }
        }

        // Auto-refresh token n·∫øu c·∫ßn
        setInterval(() => {
            if (!jwtToken) {
                jwtToken = prompt('JWT Token ƒë√£ h·∫øt h·∫°n. Nh·∫≠p token m·ªõi:');
                if (jwtToken) {
                    localStorage.setItem('jwt_token', jwtToken);
                }
            }
        }, 60000); // Check m·ªói ph√∫t
    </script>
</body>
</html>
